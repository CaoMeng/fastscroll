(function(t,i,o){var s="ontouchstart"in t,n=s?"touchstart":"mousedown",r=s?"touchmove":"mousemove",e=s?"touchend":"mouseup",l=s?"touchcancel":"mouseup";function h(){return(new Date).getTime()}function a(t,i,s,n,r,e){var l=t-i,h=o.abs(l)/s,a,c;e=e===undefined?6e-4:e;a=t+h*h/(2*e)*(l<0?-1:1);c=h/e;if(a<n){a=r?n-r/2.5*(h/8):n;l=o.abs(a-t);c=l/h}else if(a>0){a=r?r/2.5*(h/8):0;l=o.abs(t)+a;c=l/h}return{destination:o.round(a),duration:c}}var c={quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(t){return t*(2-t)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(t){return o.sqrt(1- --t*t)}}};function u(t,o){if(t.charAt&&t.charAt(0)=="#"){t=t.substr(1,t.length-1)}this.wrapper=typeof t=="string"?i.getElementById(t):t;this.wrapper.style.overflow="hidden";this.scroller=this.wrapper.children[0];this.scrollerStyle=this.scroller.style;this.options={momentum:true,bounce:true,deceleration:undefined,bounceTime:600,startX:0,startY:0,scrollX:false,scrollY:true,directionLockThreshold:5,onfunction:function(t){t.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null};for(var s in o){this.options[s]=o[s]}this.options.bounceEasing=c.circular;this.x=0;this.y=0;this.directionX=0;this.directionY=0;this.translateZ=" translateZ(0)";this._init();this.refresh();this.scrollTo(this.options.startX,this.options.startY)}u.prototype={refresh:function t(){console.log("refresh");var i=this;var s=this.options.wrapperWidth;var n=this.options.wrapperHeight;var r=this.options.scrollerWidth;var e=this.options.scrollerHeight;i.wrapperW=s||i.wrapper.clientWidth||1;i.wrapperH=n||i.wrapper.clientHeight||1;this.wrapperWidth=s||this.wrapper.clientWidth;this.wrapperHeight=n||this.wrapper.clientHeight;i.minScrollY=-i.options.topOffset||0;i.scrollerW=r||o.round(i.scroller.offsetWidth);i.scrollerH=e||o.round(i.scroller.offsetHeight+i.minScrollY);i.maxScrollX=i.wrapperW-i.scrollerW;i.maxScrollY=i.wrapperH-i.scrollerH+i.minScrollY;this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0;this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0;if(!this.hasHorizontalScroll){this.maxScrollX=0;this.scrollerWidth=this.wrapperWidth}if(!this.hasVerticalScroll){this.maxScrollY=0;this.scrollerHeight=this.wrapperHeight}i.endTime=0;i.directionX=0;i.directionY=0;if(i.options.onRefresh)i.options.onRefresh.call(i);i._resetPos()},getComputedPosition:function(){var i=t.getComputedStyle(this.scroller,null),o,s;console.log("getComputedPosition------",i.webkitTransform);i=i.webkitTransform.split(")")[0].split(", ");o=+(i[12]||i[4]);s=+(i[13]||i[5]);return{x:o,y:s}},_init:function(){this._initEvents()},_initEvents:function(){this._bind(n)},_onStart:function t(i){console.log("_onStart");var s=this;var n=i.target;while(n.nodeType!=1)n=n.parentNode;if(n.tagName!="SELECT"&&n.tagName!="INPUT"&&n.tagName!="TEXTAREA"){i.preventDefault()}if(this.options.onBeforeScrollStart)this.options.onBeforeScrollStart.call(this,i);this.moved=false;var a=i.touches?i.touches[0]:i;this.distX=0;this.distY=0;this.directionLocked=0;this.startTime=h();this._transitionTime();this.startX=this.x;this.startY=this.y;this.pointX=a.pageX;this.pointY=a.pageY;if(this.isInTransition){console.log("--------------in transition............",this.scrollerStyle.webkitTransitionDuration);s.isInTransition=false;var c=s.getComputedPosition();s._translate(o.round(c.x),o.round(c.y));s.startX=s.x;s.startY=s.y}if(this.options.onScrollStart)this.options.onScrollStart.call(this,i);this._bind(r);this._bind(e);this._bind(l);this._bind("webkitTransitionEnd")},_onMove:function t(i){console.log("_onMove");var s=this;i.preventDefault();var n=i.touches?i.touches[0]:i;var r=n.pageX-this.pointX;var e=n.pageY-this.pointY;if(s.options.onBeforeScrollMove)s.options.onBeforeScrollMove.call(s,i);var l=h();var a,c,u,d;this.pointX=n.pageX;this.pointY=n.pageY;this.distX+=r;this.distY+=e;a=o.abs(this.distX);c=o.abs(this.distY);if(a>c+this.options.directionLockThreshold){this.directionLocked="h"}else if(c>=a+this.options.directionLockThreshold){this.directionLocked="v"}else{this.directionLocked="n"}if(this.directionLocked=="h"){e=0}else if(this.directionLocked=="v"){r=0}r=this.hasHorizontalScroll?r:0;e=this.hasVerticalScroll?e:0;u=this.x+r;d=this.y+e;if(l-this.endTime>300&&(a<10&&c<10)){return}if(u>0||u<s.maxScrollX){u=s.options.bounce?s.x+r/3:u>=0||s.maxScrollX>=0?0:s.maxScrollX}if(d>this.minScrollY||d<this.maxScrollY){d=this.options.bounce?this.y+e/3:d>=this.minScrollY||this.maxScrollY>=0?this.minScrollY:this.maxScrollY}this.moved=true;this._translate(u,d);this.directionY=e>0?-1:e<0?1:0;if(l-this.startTime>300){this.startTime=l;this.startX=this.x;this.startY=this.y}if(this.options.onScrollMove)this.options.onScrollMove.call(this,i)},_onEnd:function t(i){console.log("_onEnd");var s=this;this.isInTransition=0;var n=o.round(this.x);var u=o.round(this.y);var d=o.abs(n-this.startX);var p=o.abs(u-this.startY);var f=h()-this.startTime;this._unbind(r);this._unbind(e);this._unbind(l);var m="";if(s.options.onBeforeScrollEnd)s.options.onBeforeScrollEnd.call(s,i);this.endTime=h();if(this._resetPos(this.options.bounceTime)){return}this.scrollTo(n,u);if(!this.moved){console.log("---------onScrollCancel");if(this.options.onScrollCancel)this.options.onScrollCancel.call(this,i);return}console.log("flick::",f,d,p);console.log("======",this.options.momentum,f);if(this.options.momentum&&f<300){var S=this.hasHorizontalScroll?a(this.x,this.startX,f,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:n,duration:0};var v=this.hasVerticalScroll?a(this.y,this.startY,f,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:u,duration:0};n=S.destination;u=v.destination;console.log("_onEnd::newY:",u);console.log(this.y,this.startY,f,this.maxScrollY,this.options.bounce);var T=o.max(S.duration,v.duration);this.isInTransition=1}if(n!=this.x||u!=this.y){if(n>0||n<this.maxScrollX||u>0||u<this.maxScrollY){m=c.quadratic}this.scrollTo(n,u,T,m);return}},scrollTo:function t(i,o,s,n){n=n||c.circular;this.isInTransition=s>0;console.log("scrollTo::",i,o,s,n);this._transitionTimingFunction(n.style);this._transitionTime(s);this._translate(i,o)},_translate:function t(i,o){console.log("_translate::",this.scrollerStyle.webkitTransitionDuration);this.scrollerStyle.webkitTransform="translate("+i+"px,"+o+"px)"+this.translateZ;this.x=i;this.y=o},_transitionTime:function t(i){i=i||0;this.scrollerStyle.webkitTransitionDuration=i+"ms"},_transitionTimingFunction:function t(i){this.scrollerStyle.webkitTransitionTimingFunction=i},_bind:function t(i,o,s){(o||this.scroller).addEventListener(i,this,!!s)},_unbind:function t(i,o,s){(o||this.scroller).removeEventListener(i,this,!!s)},handleEvent:function(t){var i=this;switch(t.type){case n:i._onStart(t);break;case r:i._onMove(t);break;case e:case l:i._onEnd(t);break;case"webkitTransitionEnd":i._onTransitionEnd(t);break}},_onTransitionEnd:function(t){console.log("_onTransitionEnd");if(t.target!=this.scroller||!this.isInTransition){return}this._transitionTime();if(!this._resetPos(this.options.bounceTime)){this.isInTransition=false;this._unbind("webkitTransitionEnd");if(this.options.onScrollEnd)this.options.onScrollEnd.call(this)}},_resetPos:function(t){console.log("_resetPos");var i=this.x,o=this.y;t=t||0;if(!this.hasHorizontalScroll||this.x>0){i=0}else if(this.x<this.maxScrollX){i=this.maxScrollX}if(!this.hasVerticalScroll||this.y>0){o=0}else if(this.y<this.maxScrollY){o=this.maxScrollY}if(i==this.x&&o==this.y){return false}console.log("-----3------");this.scrollTo(i,o,t,this.options.bounceEasing);return true}};t.FastScroll=t.fs=t.FS=t.is=t.IS=u;if(!t.IScroll){t.IScroll=u}})(window,document,Math);